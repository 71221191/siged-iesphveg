{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Historial {{ documento.expediente_id }}</title>
    <style>
        body { font-family: 'Arial', sans-serif; margin: 40px; font-size: 12px; }
        .header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #000; padding-bottom: 10px; }
        .header h2 { margin: 5px 0; }
        .meta-info { width: 100%; margin-bottom: 20px; border: 1px solid #000; padding: 10px; }
        .meta-info td { padding: 5px; vertical-align: top; }
        .label { font-weight: bold; width: 150px; }
        
        .history-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .history-table th, .history-table td { border: 1px solid #000; padding: 8px; text-align: left; }
        .history-table th { background-color: #f0f0f0; }
        
        .footer { margin-top: 30px; font-size: 10px; text-align: center; border-top: 1px solid #ccc; padding-top: 5px; }
        
        @media print { .no-print { display: none; } }
    </style>
</head>
<body onload="window.print()">

    <div class="no-print" style="text-align: right; margin-bottom: 20px;">
        <button onclick="window.print()">üñ®Ô∏è Imprimir</button>
        <button onclick="window.close()">Cerrar</button>
    </div>

    <div class="header">
        <h3>IESP "HNO. VICTORINO ELORZ GOICOECHEA"</h3>
        <h2>HOJA DE RUTA / HISTORIAL DEL TR√ÅMITE</h2>
    </div>

    <table class="meta-info">
        <tr>
            <td class="label">N¬∞ EXPEDIENTE:</td>
            <td style="font-size: 16px; font-weight: bold;">{{ documento.expediente_id }}</td>
            <td class="label">ESTADO FINAL:</td>
            <td>{{ documento.get_estado_display|upper }}</td>
        </tr>
        <tr>
            <td class="label">TR√ÅMITE:</td>
            <td>{{ documento.procedimiento.nombre }}</td>
            <td class="label">FECHA INICIO:</td>
            <td>{{ documento.fecha_ingreso|date:"d/m/Y H:i" }}</td>
        </tr>
        <tr>
            <td class="label">SOLICITANTE:</td>
            <td colspan="3">{{ documento.remitente }} ({{ documento.identificador_remitente }})</td>
        </tr>
        <tr>
            <td class="label">ASUNTO:</td>
            <td colspan="3">{{ documento.asunto }}</td>
        </tr>
    </table>

    <h4>DETALLE DE MOVIMIENTOS</h4>
    <table class="history-table">
        <thead>
            <tr>
                <th style="width: 30px;">#</th>
                <th style="width: 120px;">Fecha/Hora</th>
                <th style="width: 150px;">Origen</th>
                <th>Acci√≥n</th>
                <th style="width: 150px;">Destino</th>
                <th>Observaciones / Prove√≠do</th>
            </tr>
        </thead>
        <tbody>
            {% for mov in movimientos %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ mov.fecha_movimiento|date:"d/m/Y H:i" }}</td>
                <td>
                    {% if mov.usuario_origen %}
                        {{ mov.usuario_origen.unidad_organizativa }}<br>
                        <i style="font-size:9px">({{ mov.usuario_origen.usuario.username }})</i>
                    {% else %}
                        SISTEMA
                    {% endif %}
                </td>
                <td>{{ mov.get_tipo_display }}</td>
                <td>
                    {% if mov.unidad_destino %}
                        {{ mov.unidad_destino.unidad_organizativa }}
                    {% else %}
                        -- FIN --
                    {% endif %}
                </td>
                <td>{{ mov.observaciones|default:"-" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="footer">
        Reporte generado el {{ fecha_impresion|date:"d/m/Y H:i:s" }} por {{ usuario_impresion }} | SGD IESP HVEG
    </div>

</body>
</html>